{# Cartes KPI + carte Leaflet à droite #}
<div class="row mb-3">

  <!-- Répartition (barres %) -->
  <div class="col-xl-3 col-md-4 col-sm-6 mb-3">
    <div id="barsCard" class="card border-left-primary shadow-sm h-100">
      <div class="card-body d-flex flex-column p-3 h-100">
        <h6 class="text-xs fw-bold text-primary text-uppercase mb-2">Répartition (%)</h6>

        <!-- Zone qui prend TOUT l'espace restant -->
        <div id="barsWrap" class="flex-grow-1 position-relative">
          <!-- Le canvas remplit barsWrap -->
          <canvas id="catBars" class="w-100 h-100"></canvas>

          <!-- Légende (une seule ligne, plein largeur) -->
          <div id="catLegend" class="position-absolute bottom-0 start-0 end-0 small px-2 pb-1"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Total + Sans site empilés -->
  <div class="col-xl-3 col-md-4 col-sm-6 mb-3">
    <div id="valuesStack" class="d-flex flex-column h-100">
      <div class="card border-left-success shadow-sm py-3 text-center mb-2 flex-fill">
        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Total asso</div>
        <div id="countTotal" class="h4 font-weight-bold mb-0">0</div>
      </div>
      <div class="card border-left-warning shadow-sm py-3 text-center flex-fill">
        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Sans site</div>
        <div id="countNoSite" class="h4 font-weight-bold mb-0">0</div>
      </div>
    </div>
  </div>

  <!-- Carte Leaflet -->
  <div class="col-xl-6 col-md-12 mb-3">
    <div class="card shadow-sm h-100">
      <div class="card-header py-2 d-flex justify-content-between align-items-center">
        <h6 class="m-0 font-weight-bold text-primary">Carte des associations</h6>
        <button id="btnOpenMapModal" class="btn btn-sm btn-outline-primary" title="Agrandir">
          <i class="fas fa-expand"></i> Agrandir
        </button>
      </div>
      <div id="mapCardBody" class="card-body p-0 d-flex flex-column">
        <div id="niortMap" class="flex-grow-1 w-100" style="min-height: 300px;"></div>
      </div>
    </div>
  </div>

</div>
